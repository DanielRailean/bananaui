var w=Object.defineProperty;var A=(i,e,t)=>e in i?w(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var p=(i,e,t)=>(A(i,typeof e!="symbol"?e+"":e,t),t);import{g,b as $}from"./entry.hRcAUPeu.js";import{O as o}from"./scheduler.BW_prjnM.js";import{u as v,D as S,c as y,p as h}from"./stores.CzWzvSbT.js";import{a as E,c as _}from"./toastStore.DWnZQe75.js";function C(i,e="GET",t,s){s||(s={}),t&&(s["content-type"]="application/json");const n={method:e,headers:s,body:JSON.stringify(t)};return fetch(i,n)}let c={};async function l(i,e="GET",t,s,n){if(e=="GET"&&o(h.useEphemeralGetRequestsCache)){if(c[n??i])return console.log(`[GET] cache hit. Total cache keys: ${Object.keys(c).length}`),c[n??i];const r=await a(i,e,t,s);r.ok&&(c[n??i]=r)}return a(i,e,t,s)}async function a(i,e="GET",t,s){const n=await C(i,e,t,s),r={ok:n.ok,code:n.status};if(n.ok)try{r.data=await n.json()}catch{}else{r.err=await n.text();try{r.errTyped=JSON.parse(r.err)}catch{}}return r}class O{constructor(e,t,s){p(this,"endpoint");p(this,"headers");this.endpoint=e,this.headers={...s},t&&(this.headers.authorization=`Bearer ${t}`)}getInfo(){return a(this.endpoint,void 0,void 0,this.headers)}request(e,t="GET",s,n=this.headers){return l(`${this.endpoint}${e.startsWith("/")?e:`/${e}`}`,t,s,{...this.headers,...n},e.startsWith("/")?e:`/${e}`)}schema(e){return a(`${this.endpoint}/schemas/${e}`,void 0,void 0,this.headers)}pluginConfig(e){return a(`${this.endpoint}/schemas/plugins/${e}`,void 0,void 0,this.headers)}async findAll(e,t={},s=""){return l(`${this.endpoint}${s}/${e}?size=${o(h.paginationSizeApi)}&sort_by=updated_at`,void 0,void 0,this.headers,`${s}/${e}?size=${o(h.paginationSizeApi)}&sort_by=updated_at`)}findRecord(e,t,s=""){return l(`${this.endpoint}${s}/${e}/${t}`,void 0,void 0,this.headers,`/${e}/${t}`)}createRecord(e,t,s=""){return a(`${this.endpoint}${s}/${e}`,"POST",t,this.headers)}updateRecord(e,t,s,n=""){return a(`${this.endpoint}${n}/${e}/${t}`,"PATCH",s,this.headers)}deleteRecord(e,t,s=""){return a(`${this.endpoint}${s}/${e}/${t}`,"DELETE",void 0,this.headers)}}let d;const T=3;let u=async i=>{var s,n;i&&i>T&&E({message:`Failed to return apiService after ${T} retries`});const e=o(v);if(e&&S.now().toUnixInteger()>e.expires&&(v.set(void 0),g(`${$}/login?auto=true`)),d)return d;const t=(s=o(y))==null?void 0:s.config;return t?!e&&((n=t.oidc)!=null&&n.enabled)?(g(`${$}/login`),await m(200),await u(i?i+1:0)):(d=new O(t.kongApi.endpoint,e==null?void 0:e.token,t.kongApi.requestHeaders),d):(await m(200),await u(i?i+1:0))};const m=i=>new Promise(e=>setTimeout(e,i)),z=(i,e=()=>{_("copied")})=>{navigator.clipboard.writeText(i).then(e,()=>{})};function L(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}const b="BANANA_UI_CONFIG";function x(){const i=localStorage.getItem(b);if(i)return JSON.parse(i)}let f;async function P(){if(f)return f;let e=(await(await u()).getInfo()).data;const t={};let s=Object.entries((e==null?void 0:e.plugins.available_on_server)??{}).sort((n,r)=>r[1].priority-n[1].priority);for(const n of s)t[n[0]]=n[1].priority;return f=t,t}async function j(i="/"){var t;return(t=(await(await u()).findAll("plugins",{},i)).data)==null?void 0:t.data}export{b as L,u as a,j as b,L as c,m as d,x as e,P as g,c as r,z as w};
