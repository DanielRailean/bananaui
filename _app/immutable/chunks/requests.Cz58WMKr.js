var f=Object.defineProperty;var $=(i,e,t)=>e in i?f(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>($(i,typeof e!="symbol"?e+"":e,t),t);import{g as l,b as m}from"./entry.jtfx6vLb.js";import{w as h}from"./scheduler.C9BGEMar.js";import{a as g,u as v,c as w}from"./stores.D5KkekL9.js";import{d as c}from"./util.BoWyuGLm.js";import{a as T}from"./config.BXLj4jD_.js";function S(i,e="GET",t,s){s||(s={}),t&&(s["content-type"]="application/json");const n={method:e,headers:s,body:JSON.stringify(t)};return fetch(i,n)}async function r(i,e="GET",t,s){const n=await S(i,e,t,s),a={ok:n.ok,code:n.status};if(n.ok)try{a.data=await n.json()}catch{}else{a.err=await n.text();try{a.errTyped=JSON.parse(a.err)}catch{}}return a}class k{constructor(e,t,s){d(this,"endpoint");d(this,"headers");this.endpoint=e,this.headers={...s},t&&(this.headers.authorization=`Bearer ${t}`)}getInfo(){return r(this.endpoint,void 0,void 0,this.headers)}request(e,t="GET",s,n=this.headers){return r(`${this.endpoint}${e.startsWith("/")?e:`/${e}`}`,t,s,{...this.headers,...n})}schema(e){return r(`${this.endpoint}/schemas/${e}`,void 0,void 0,this.headers)}pluginConfig(e){return r(`${this.endpoint}/schemas/plugins/${e}`,void 0,void 0,this.headers)}async findAll(e,t={},s=""){return r(`${this.endpoint}${s}/${e}?size=${T}`,void 0,void 0,this.headers)}findRecord(e,t){return r(`${this.endpoint}/${e}/${t}`,void 0,void 0,this.headers)}createRecord(e,t){return r(`${this.endpoint}/${e}`,"POST",t,this.headers)}updateRecord(e,t,s){return r(`${this.endpoint}/${e}/${t}`,"PATCH",s,this.headers)}deleteRecord(e,t){return r(`${this.endpoint}/${e}/${t}`,"DELETE",void 0,this.headers)}}let o;const p=3;let u=async i=>{var s;if(i&&i>p&&g({message:`Failed to return apiService after ${p} retries`}),o)return o;const e=h(v),t=(s=h(w))==null?void 0:s.config;return t?!e&&t.auth.enabled?(l(`${m}/login`),await c(200),await u(i?i+1:0)):(o=new k(t.kongApi.endpoint,e,t.kongApi.requestHeaders),o):(await c(200),await u(i?i+1:0))};export{u as a};
