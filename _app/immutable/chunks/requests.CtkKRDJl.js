var $=Object.defineProperty;var l=(s,t,e)=>t in s?$(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var c=(s,t,e)=>(l(s,typeof t!="symbol"?t+"":t,e),e);import{g as v,b as g}from"./entry.BfzaUJbn.js";import{D as u}from"./scheduler.BQDiRXjc.js";import{a as m,u as w,c as T}from"./stores.DxlP-Spi.js";import{d as k}from"./util.cKKlGT0C.js";import{p as x}from"./config.CwKg5LUm.js";function y(s,t="GET",e,a){a||(a={}),e&&(a["content-type"]="application/json");const i={method:t,headers:a,body:JSON.stringify(e)};return fetch(s,i)}async function n(s,t="GET",e,a){const i=await y(s,t,e,a),r={ok:i.ok,code:i.status};if(i.ok)try{r.data=await i.json()}catch{}else{r.err=await i.text();try{r.errTyped=JSON.parse(r.err)}catch{}}return r}class E{constructor(t,e,a){c(this,"endpoint");c(this,"headers");this.endpoint=t,this.headers={...a},e&&(this.headers.authorization=`Bearer ${e}`)}getInfo(){return n(this.endpoint,void 0,void 0,this.headers)}request(t,e="GET",a,i){return n(`${this.endpoint}${t.startsWith("/")?t:`/${t}`}`,e,a,{...this.headers,...i})}schema(t){return n(`${this.endpoint}/schemas/${t}`,void 0,void 0,this.headers)}pluginConfig(t){return n(`${this.endpoint}/schemas/plugins/${t}`,void 0,void 0,this.headers)}async findAll(t,e={},a=""){var r,p;const i=await n(`${this.endpoint}${a}/${t}?size=${x}`,void 0,void 0,this.headers);if(i.data&&i.data.next){let d=i.data.data,o=await this.request(i.data.next,void 0,void 0,this.headers);for(d=d.concat((r=o.data)==null?void 0:r.data);o&&o.data&&o.data.next;)o=await this.request(o.data.next??"",void 0,void 0,this.headers),d=d.concat((p=o.data)==null?void 0:p.data);i.data.data=d}return i}findRecord(t,e){return n(`${this.endpoint}/${t}/${e}`,void 0,void 0,this.headers)}createRecord(t,e){return n(`${this.endpoint}/${t}`,"POST",e,this.headers)}updateRecord(t,e,a){return n(`${this.endpoint}/${t}/${e}`,"PATCH",a,this.headers)}deleteRecord(t,e){return n(`${this.endpoint}/${t}/${e}`,"DELETE",void 0,this.headers)}}let h;const f=3;let S=async s=>{var a;if(s&&s>f&&m({message:`Failed to return apiService after ${f} retries`}),h)return h;const t=u(w),e=(a=u(T))==null?void 0:a.config;if(!e)return await k(200),await S(s?s+1:0);if(!t&&e.auth.enabled)throw v(`${g}/login`),new Error("no token");return h=new E(e.kongApi.endpoint,t,e.kongApi.requestHeaders),h};export{S as a};
