var v=Object.defineProperty;var m=(i,t,e)=>t in i?v(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var d=(i,t,e)=>(m(i,typeof t!="symbol"?t+"":t,e),e);import{g as h,b as l}from"./entry.CnokGsX9.js";import{O as u}from"./scheduler.BW_prjnM.js";import{u as f,D as w,c as T,p as A}from"./stores.BCnvssqg.js";import{a as y,c as S}from"./toastStore.Df-PFYaH.js";function O(i,t="GET",e,r){r||(r={}),e&&(r["content-type"]="application/json");const n={method:t,headers:r,body:JSON.stringify(e)};return fetch(i,n)}async function s(i,t="GET",e,r){const n=await O(i,t,e,r),a={ok:n.ok,code:n.status};if(n.ok)try{a.data=await n.json()}catch{}else{a.err=await n.text();try{a.errTyped=JSON.parse(a.err)}catch{}}return a}class _{constructor(t,e,r){d(this,"endpoint");d(this,"headers");this.endpoint=t,this.headers={...r},e&&(this.headers.authorization=`Bearer ${e}`)}getInfo(){return s(this.endpoint,void 0,void 0,this.headers)}request(t,e="GET",r,n=this.headers){return s(`${this.endpoint}${t.startsWith("/")?t:`/${t}`}`,e,r,{...this.headers,...n})}schema(t){return s(`${this.endpoint}/schemas/${t}`,void 0,void 0,this.headers)}pluginConfig(t){return s(`${this.endpoint}/schemas/plugins/${t}`,void 0,void 0,this.headers)}async findAll(t,e={},r=""){return s(`${this.endpoint}${r}/${t}?size=${u(A.paginationSizeApi)}&sort_by=updated_at`,void 0,void 0,this.headers)}findRecord(t,e,r=""){return s(`${this.endpoint}${r}/${t}/${e}`,void 0,void 0,this.headers)}createRecord(t,e,r=""){return s(`${this.endpoint}${r}/${t}`,"POST",e,this.headers)}updateRecord(t,e,r,n=""){return s(`${this.endpoint}${n}/${t}/${e}`,"PATCH",r,this.headers)}deleteRecord(t,e,r=""){return s(`${this.endpoint}${r}/${t}/${e}`,"DELETE",void 0,this.headers)}}let o;const g=3;let c=async i=>{var r,n;i&&i>g&&y({message:`Failed to return apiService after ${g} retries`});const t=u(f);if(t&&w.now().toUnixInteger()>t.expires&&(f.set(void 0),h(`${l}/login?auto=true`)),o)return o;const e=(r=u(T))==null?void 0:r.config;return e?!t&&((n=e.oidc)!=null&&n.enabled)?(h(`${l}/login`),await $(200),await c(i?i+1:0)):(o=new _(e.kongApi.endpoint,t==null?void 0:t.token,e.kongApi.requestHeaders),o):(await $(200),await c(i?i+1:0))};const $=i=>new Promise(t=>setTimeout(t,i)),L=(i,t=()=>{S("copied")})=>{navigator.clipboard.writeText(i).then(t,()=>{})};function P(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}const b="BANANA_UI_CONFIG";function R(){const i=localStorage.getItem(b);if(i)return JSON.parse(i)}let p;async function k(){if(p)return p;let t=(await(await c()).getInfo()).data;const e={};let r=Object.entries((t==null?void 0:t.plugins.available_on_server)??{}).sort((n,a)=>a[1].priority-n[1].priority);for(const n of r)e[n[0]]=n[1].priority;return p=e,e}async function q(i="/"){var e;return(e=(await(await c()).findAll("plugins",{},i)).data)==null?void 0:e.data}export{b as L,c as a,q as b,P as c,$ as d,R as e,k as g,L as w};
