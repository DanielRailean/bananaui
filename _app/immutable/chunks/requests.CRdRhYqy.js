var p=Object.defineProperty;var u=(s,e,t)=>e in s?p(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>(u(s,typeof e!="symbol"?e+"":e,t),t);import{g as f,b as $}from"./entry.CfJbK9Xn.js";import{w as h}from"./scheduler.C9BGEMar.js";import{a as l,u as m,c as g}from"./stores.D5KkekL9.js";import{d as v}from"./util.BoWyuGLm.js";import{a as w}from"./config.Cku55jh0.js";function T(s,e="GET",t,i){i||(i={}),t&&(i["content-type"]="application/json");const r={method:e,headers:i,body:JSON.stringify(t)};return fetch(s,r)}async function n(s,e="GET",t,i){const r=await T(s,e,t,i),o={ok:r.ok,code:r.status};if(r.ok)try{o.data=await r.json()}catch{}else{o.err=await r.text();try{o.errTyped=JSON.parse(o.err)}catch{}}return o}class k{constructor(e,t,i){d(this,"endpoint");d(this,"headers");this.endpoint=e,this.headers={...i},t&&(this.headers.authorization=`Bearer ${t}`)}getInfo(){return n(this.endpoint,void 0,void 0,this.headers)}request(e,t="GET",i,r=this.headers){return n(`${this.endpoint}${e.startsWith("/")?e:`/${e}`}`,t,i,{...this.headers,...r})}schema(e){return n(`${this.endpoint}/schemas/${e}`,void 0,void 0,this.headers)}pluginConfig(e){return n(`${this.endpoint}/schemas/plugins/${e}`,void 0,void 0,this.headers)}async findAll(e,t={},i=""){return n(`${this.endpoint}${i}/${e}?size=${w}`,void 0,void 0,this.headers)}findRecord(e,t){return n(`${this.endpoint}/${e}/${t}`,void 0,void 0,this.headers)}createRecord(e,t){return n(`${this.endpoint}/${e}`,"POST",t,this.headers)}updateRecord(e,t,i){return n(`${this.endpoint}/${e}/${t}`,"PATCH",i,this.headers)}deleteRecord(e,t){return n(`${this.endpoint}/${e}/${t}`,"DELETE",void 0,this.headers)}}let a;const c=3;let y=async s=>{var i;if(s&&s>c&&l({message:`Failed to return apiService after ${c} retries`}),a)return a;const e=h(m),t=(i=h(g))==null?void 0:i.config;if(!t)return await v(200),await y(s?s+1:0);if(!e&&t.auth.enabled)throw f(`${$}/login`),new Error("no token");return a=new k(t.kongApi.endpoint,e,t.kongApi.requestHeaders),a};export{y as a};
